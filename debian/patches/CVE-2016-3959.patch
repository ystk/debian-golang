Origin: https://golang.org/cl/21533
Origin: https://github.com/golang/go/commit/eb876dd83cb8413335d64e50aae5d38337d1ebb4
Reviewed-by: Sylvain Beucler <beuc@debian.org>
Last-Update: 2021-02-24

From eb876dd83cb8413335d64e50aae5d38337d1ebb4 Mon Sep 17 00:00:00 2001
From: Robert Griesemer <gri@golang.org>
Date: Tue, 5 Apr 2016 09:44:00 -0700
Subject: [PATCH] crypto/dsa: eliminate invalid PublicKey early

For PublicKey.P == 0, Verify will fail. Don't even try.

Change-Id: I1009f2b3dead8d0041626c946633acb10086d8c8
Reviewed-on: https://go-review.googlesource.com/21533
Reviewed-by: Brad Fitzpatrick <bradfitz@golang.org>
Run-TryBot: Brad Fitzpatrick <bradfitz@golang.org>
TryBot-Result: Gobot Gobot <gobot@golang.org>
---
 src/crypto/dsa/dsa.go | 4 ++++
 1 file changed, 4 insertions(+)

Index: golang-1.3.3/src/pkg/crypto/dsa/dsa.go
===================================================================
--- golang-1.3.3.orig/src/pkg/crypto/dsa/dsa.go
+++ golang-1.3.3/src/pkg/crypto/dsa/dsa.go
@@ -249,6 +249,10 @@ func Sign(rand io.Reader, priv *PrivateK
 func Verify(pub *PublicKey, hash []byte, r, s *big.Int) bool {
 	// FIPS 186-3, section 4.7
 
+	if pub.P.Sign() == 0 {
+		return false
+	}
+
 	if r.Sign() < 1 || r.Cmp(pub.Q) >= 0 {
 		return false
 	}
